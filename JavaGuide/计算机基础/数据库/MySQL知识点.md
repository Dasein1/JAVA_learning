# 事务
## 何为事务？
事务是逻辑上的一组操作，要么都执行，要么都不执行。
例子：
1.将小明的余额减少 1000 元
2.将小红的余额增加 1000 元

## 何为数据库事务？
数据库事务可以保证多个对数据库的操作（也就是 SQL 语句）构成一个逻辑上的整体。构成这个逻辑上的整体的这些数据库操作遵循：要么全部执行成功,要么全部不执行。
另外，关系型数据库都有ACID特性

## 何为ACID特性？
原子性：事务是最小的执行单位，不允许分割。
一致性：执行事务前后，数据保持一致
隔离性：并发访问数据库时，一个用户的事务不被其他事务所干扰，各并发事务之间数据库是独立的；
持久性：一个事务被提交之后。它对数据库中数据的改变是持久的，即使数据库发生故障也不应该对其有任何影响。

## 并发事务带来哪些问题？
https://blog.csdn.net/qq_33591903/article/details/81672260
·脏读：读取到还没有被提交的数据
·丢失修改（Lost to modify）: 指在一个事务读取一个数据时，另外一个事务也访问了该数据，那么在第一个事务中修改了这个数据后，第二个事务也
修改了这个数据。这样第一个事务内的修改结果就被丢失，因此称为丢失修改。 例如：事务 1 读取某表中的数据 A=20，事务 2 也读取 A=20，事务1修改 A=A-1，事务 2 也修改 A=A-1，最终结果 A=19，事务 1 的修改被丢失。
·不可重复读：在一个事务内两次读到的数据不一样。
·幻读：在同一个事务内读取到的数据总量不一致。

## 事务隔离级别有哪些？
读取未提交：可能导致脏读、幻读或不可重复读
读取已提交：可能导致幻读或不可重复度
可重复读：导致幻读
可串行化：所有事务依次逐个执行

## MySQL的默认隔离级别是什么？
可重复读
MySQL InnoDB 的 REPEATABLE-READ（可重读）并不保证避免幻读，需要应用使用加锁读来保证。而这个加锁读使用到的机制就是 Next-Key Locks。（没有性能损失）
InnoDB 存储引擎在 分布式事务 的情况下一般会用到 SERIALIZABLE(可串行化) 隔离级别

# 锁机制与InnoDB锁算法
## NyISAM和InnoDB存储引擎使用的锁：
·MyISAM采用表级锁
·InnoDB支持行级锁和表急锁，默认为行级锁

## 表级锁和行级锁对比：
粒度、资源、速度、死锁、触发所冲突、并发度
表级锁
行级锁

## InnoDB存储引擎的锁算法：
·Record lock：记录锁，单个行记录上的锁
·Gap lock：间隙锁，锁定一个范围，不包括记录本身
·Next-key lock：record+gap 临键锁，锁定一个范围，包含记录本身

